!function(n){"use strict";function t(){this.body=n("body"),this.window=n(window),this.menuContainer=n("#leftside-menu-container")}t.prototype._reset=function(){this.body.removeAttr("data-leftbar-theme")},t.prototype.activateCondensedSidebar=function(){this.body.attr("data-leftbar-compact-mode","condensed")},t.prototype.deactivateCondensedSidebar=function(){this.body.removeAttr("data-leftbar-compact-mode")},t.prototype.activateScrollableSidebar=function(){this.body.attr("data-leftbar-compact-mode","scrollable")},t.prototype.deactivateScrollableSidebar=function(){this.body.removeAttr("data-leftbar-compact-mode")},t.prototype.activateDefaultTheme=function(){this._reset(),this.body.attr("data-leftbar-theme","default")},t.prototype.activateLightTheme=function(){this._reset(),this.body.attr("data-leftbar-theme","light")},t.prototype.activateDarkTheme=function(){this._reset(),this.body.attr("data-leftbar-theme","dark")},t.prototype.initMenu=function(){var t,e=this;this._reset(),n(document).on("click",".button-menu-mobile",function(t){t.preventDefault(),e.body.toggleClass("sidebar-enable"),"full"===e.body.attr("data-layout")||e.window.width()<768?e.body.toggleClass("hide-menu"):"condensed"===e.body.attr("data-leftbar-compact-mode")?e.deactivateCondensedSidebar():e.activateCondensedSidebar()}),n(".side-nav").length&&(t=n(".side-nav li .collapse"),n(".side-nav li [data-bs-toggle='collapse']").on("click",function(t){return!1}),t.on({"show.bs.collapse":function(t){var e=n(t.target).parents(".collapse.show");n(".side-nav .collapse.show").not(t.target).not(e).collapse("hide")}}),n(".side-nav a").each(function(){var t,e,a,o=window.location.href.split(/[?#]/)[0];this.href==o&&(n(this).addClass("active"),n(this).parent().addClass("menuitem-active"),n(this).parent().parent().parent().addClass("show"),n(this).parent().parent().parent().parent().addClass("menuitem-active"),"sidebar-menu"!==(t=n(this).parent().parent().parent().parent().parent().parent()).attr("id")&&t.addClass("show"),n(this).parent().parent().parent().parent().parent().parent().parent().addClass("menuitem-active"),"wrapper"!==(e=n(this).parent().parent().parent().parent().parent().parent().parent().parent().parent()).attr("id")&&e.addClass("show"),(a=n(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent()).is("body")||a.addClass("menuitem-active"))}));var a=document.querySelectorAll("ul.navbar-nav .dropdown .dropdown-toggle"),o=!1;a.forEach(function(a){a.addEventListener("click",function(t){var e;a.parentElement.classList.contains("nav-item")||(o=!0,e=a.parentElement.parentElement.parentElement.querySelector(".nav-link"),bootstrap.Dropdown.getInstance(e).show(),a.ariaExpanded?bootstrap.Dropdown.getInstance(a).hide():bootstrap.Dropdown.getInstance(e).show(),o=!0)}),a.addEventListener("hide.bs.dropdown",function(t){o&&(t.preventDefault(),t.stopPropagation(),o=!1)}),a.addEventListener("show.bs.dropdown",function(t){o||a.parentElement.classList.contains("nav-item")||(t.preventDefault(),t.stopPropagation(),o=!0)})})},t.prototype.init=function(){this.initMenu()},n.LeftSidebar=new t,n.LeftSidebar.Constructor=t}(window.jQuery),function(a){"use strict";function t(){this.$body=a("body"),this.$window=a(window)}t.prototype.initMenu=function(){a(".topnav-menu").length&&(a(".topnav-menu li a").each(function(){var t=window.location.href.split(/[?#]/)[0];this.href==t&&(a(this).addClass("active"),a(this).parent().parent().addClass("active"),a(this).parent().parent().parent().parent().addClass("active"),a(this).parent().parent().parent().parent().parent().parent().addClass("active"))}),a(".navbar-toggle").on("click",function(){a(this).toggleClass("open"),a("#navigation").slideToggle(400)}))},t.prototype.initSearch=function(){var e=a(".navbar-custom .dropdown:not(.app-search)");a(document).on("click",function(t){return"top-search"==t.target.id||t.target.closest("#search-dropdown")?a("#search-dropdown").addClass("d-block"):a("#search-dropdown").removeClass("d-block"),!0}),a("#top-search").on("focus",function(t){return t.preventDefault(),e.children(".dropdown-menu.show").removeClass("show"),a("#search-dropdown").addClass("d-block"),!1}),e.on("show.bs.dropdown",function(){a("#search-dropdown").removeClass("d-block")})},t.prototype.init=function(){this.initMenu(),this.initSearch()},a.Topbar=new t,a.Topbar.Constructor=t}(window.jQuery),function(a){"use strict";function t(){this.body=a("body"),this.window=a(window)}t.prototype._selectOptionsFromConfig=function(){var t=a.App.getLayoutConfig();if(t){switch(a(".end-bar input[type=checkbox]").prop("checked",!1),t.sideBarTheme){case"default":a("#default-check").prop("checked",!0);break;case"light":a("#light-check").prop("checked",!0);break;case"dark":a("#dark-check").prop("checked",!0)}t.isBoxed?a("#boxed-check").prop("checked",!0):a("#fluid-check").prop("checked",!0),t.isCondensed&&a("#condensed-check").prop("checked",!0),t.isScrollable&&a("#scrollable-check").prop("checked",!0),t.isScrollable||t.isCondensed||a("#fixed-check").prop("checked",!0),t.isDarkModeEnabled||(a("#light-mode-check").prop("checked",!0),"vertical"===t.layout&&a("input[type=checkbox][name=theme]").prop("disabled",!1)),t.isDarkModeEnabled&&(a("#dark-mode-check").prop("checked",!0),"vertical"===t.layout&&a("input[type=checkbox][name=theme]").prop("disabled",!1))}},t.prototype.toggleRightSideBar=function(){this.body.toggleClass("end-bar-enabled"),this._selectOptionsFromConfig()},t.prototype.init=function(){var e=this;"true"==document.body.getAttribute("data-rightbar-onstart")&&(localStorage.getItem("_HYPER_VISITED")||(localStorage.setItem("_HYPER_VISITED",!0),e.toggleRightSideBar())),a(document).on("click",".end-bar-toggle",function(){e.toggleRightSideBar()}),a(document).on("click","body",function(t){0<a(t.target).closest(".end-bar-toggle, .end-bar").length||0<a(t.target).closest(".leftside-menu, .side-nav").length||a(t.target).hasClass("button-menu-mobile")||0<a(t.target).closest(".button-menu-mobile").length||(a("body").removeClass("end-bar-enabled"),a("body").removeClass("sidebar-enable"))}),a("input[type=checkbox][name=width]").change(function(){switch(a(this).val()){case"fluid":a.App.activateFluid();break;case"boxed":a.App.activateBoxed()}e._selectOptionsFromConfig()}),a("input[type=checkbox][name=theme]").change(function(){switch(a(this).val()){case"default":a.App.activateDefaultSidebarTheme();break;case"light":a.App.activateLightSidebarTheme();break;case"dark":a.App.activateDarkSidebarTheme()}e._selectOptionsFromConfig()}),a("input[type=checkbox][name=compact]").change(function(){switch(a(this).val()){case"fixed":a.App.deactivateCondensedSidebar(),a.App.deactivateScrollableSidebar();break;case"scrollable":a.App.activateScrollableSidebar();break;case"condensed":a.App.activateCondensedSidebar()}e._selectOptionsFromConfig()}),a("input[type=checkbox][name=color-scheme-mode]").change(function(){switch(a(this).val()){case"light":a.App.deactivateDarkMode(),a("#default-check").prop("checked",!0),a("input[type=checkbox][name=theme]").prop("disabled",!1);break;case"dark":a.App.activateDarkMode(),a("#dark-check").prop("checked",!0)}e._selectOptionsFromConfig()}),a("#resetBtn").on("click",function(t){t.preventDefault(),a.App.resetLayout(function(){e._selectOptionsFromConfig()})})},a.RightBar=new t,a.RightBar.Constructor=t}(window.jQuery),function(a){"use strict";function t(){this.body=a("body"),this.window=a(window),this._config={},this.defaultSelectedStyle=null}var e="default",o="light",n="dark",i={sideBarTheme:e,isBoxed:!1,isCondensed:!1,isScrollable:!1,isDarkModeEnabled:!1};t.prototype._saveConfig=function(t){a.extend(this._config,t)},t.prototype._getStoredConfig=function(){var t=i,e=this.body.attr("data-layout-color");e&&"dark"==e&&(t.isDarkModeEnabled=!0),t.sideBarTheme=this.body.attr("data-leftbar-theme"),"boxed"===this.body.attr("data-layout-mode")&&(t.isBoxed=!0);var a=this.body.attr("data-leftbar-compact-mode");return"condensed"===a?t.isCondensed=!0:"scrollable"===a&&(t.isScrollable=!0),t},t.prototype._applyConfig=function(){var t=this;switch(this._config=this._getStoredConfig(),a.LeftSidebar.init(),t._config.sideBarTheme){case n:t.activateDarkSidebarTheme();break;case o:t.activateLightSidebarTheme();break;case e:t.activateDefaultSidebarTheme()}t._config.isDarkModeEnabled?t.activateDarkMode():t.deactivateDarkMode(),t._config.isBoxed&&t.activateBoxed(),t._config.isCondensed&&t.activateCondensedSidebar(),t._config.isScrollable&&t.activateScrollableSidebar()},t.prototype._adjustLayout=function(){var t;750<=this.window.width()&&this.window.width()<=1028?this.activateCondensedSidebar(!0):(t=this._getStoredConfig()).isCondensed||t.isScrollable||this.deactivateCondensedSidebar()},t.prototype.activateFluid=function(){this._saveConfig({isBoxed:!1}),this.body.attr("data-layout-mode","fluid")},t.prototype.activateBoxed=function(){this._saveConfig({isBoxed:!0}),this.body.attr("data-layout-mode","boxed")},t.prototype.activateCondensedSidebar=function(t){t||this._saveConfig({isCondensed:!0,isScrollable:!1}),a.LeftSidebar.activateCondensedSidebar()},t.prototype.deactivateCondensedSidebar=function(){this._saveConfig({isCondensed:!1}),a.LeftSidebar.deactivateCondensedSidebar()},t.prototype.activateScrollableSidebar=function(){this._saveConfig({isScrollable:!0,isCondensed:!1}),a.LeftSidebar.activateScrollableSidebar()},t.prototype.deactivateScrollableSidebar=function(){this._saveConfig({isScrollable:!1}),a.LeftSidebar.deactivateScrollableSidebar()},t.prototype.activateDefaultSidebarTheme=function(){a.LeftSidebar.activateDefaultTheme(),this._saveConfig({sideBarTheme:e})},t.prototype.activateLightSidebarTheme=function(){a.LeftSidebar.activateLightTheme(),this._saveConfig({sideBarTheme:o})},t.prototype.activateDarkSidebarTheme=function(){a.LeftSidebar.activateDarkTheme(),this._saveConfig({sideBarTheme:n})},t.prototype.activateDarkMode=function(){document.body.setAttribute("data-layout-color","dark"),"detached"===!this.body.attr("data-layout")?(a.LeftSidebar.activateDarkTheme(),this._saveConfig({isDarkModeEnabled:!0,sideBarTheme:n})):this._saveConfig({isDarkModeEnabled:!0})},t.prototype.deactivateDarkMode=function(){document.body.setAttribute("data-layout-color","light"),this._saveConfig({isDarkModeEnabled:!1})},t.prototype.clearSavedConfig=function(){this._config=i},t.prototype.getConfig=function(){return this._config},t.prototype.reset=function(t){this.clearSavedConfig();var e=this;a("#main-style-container").length&&(e.defaultSelectedStyle=a("#main-style-container").attr("href")),e.deactivateCondensedSidebar(),e.deactivateDarkMode(),e.activateDefaultSidebarTheme(),e.activateFluid(),t()},t.prototype.init=function(){var e=this;a("#main-style-container").length&&(e.defaultSelectedStyle=a("#main-style-container").attr("href")),this._applyConfig(),this._adjustLayout(),this.window.on("resize",function(t){t.preventDefault(),e._adjustLayout()}),a.Topbar.init()},a.LayoutThemeApp=new t,a.LayoutThemeApp.Constructor=t}(window.jQuery),function(n){"use strict";function t(){this.$body=n("body"),this.$portletIdentifier=".card",this.$portletCloser='.card a[data-bs-toggle="remove"]',this.$portletRefresher='.card a[data-bs-toggle="reload"]'}t.prototype.init=function(){var o=this;n(document).on("click",this.$portletCloser,function(t){t.preventDefault();var e=n(this).closest(o.$portletIdentifier),a=e.parent();e.remove(),0==a.children().length&&a.remove()}),n(document).on("click",this.$portletRefresher,function(t){t.preventDefault();var e=n(this).closest(o.$portletIdentifier);e.append('<div class="card-disabled"><div class="card-portlets-loader"></div></div>');var a=e.find(".card-disabled");setTimeout(function(){a.fadeOut("fast",function(){a.remove()})},500+5*Math.random()*300)})},n.Portlet=new t,n.Portlet.Constructor=t}(window.jQuery),function(i){"use strict";function t(){this.$body=i("body"),this.$window=i(window)}t.prototype.initSelect2=function(){i('[data-toggle="select2"]').select2()},t.prototype.initMask=function(){i('[data-toggle="input-mask"]').each(function(t,e){var a=i(e).data("maskFormat"),o=i(e).data("reverse");null!=o?i(e).mask(a,{reverse:o}):i(e).mask(a)})},t.prototype.initDateRange=function(){var o={cancelClass:"btn-light",applyButtonClasses:"btn-success"};i('[data-toggle="date-picker"]').each(function(t,e){var a=i.extend({},o,i(e).data());i(e).daterangepicker(a)});var n={startDate:moment().subtract(29,"days"),endDate:moment(),ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}};i('[data-toggle="date-picker-range"]').each(function(t,e){var a=i.extend({},n,i(e).data()),o=a.targetDisplay;i(e).daterangepicker(a,function(t,e){o&&i(o).html(t.format("MMMM D, YYYY")+" - "+e.format("MMMM D, YYYY"))})})},t.prototype.initTimePicker=function(){var o={showSeconds:!0,icons:{up:"mdi mdi-chevron-up",down:"mdi mdi-chevron-down"}};i('[data-toggle="timepicker"]').each(function(t,e){var a=i.extend({},o,i(e).data());i(e).timepicker(a)})},t.prototype.initTouchspin=function(){var o={};i('[data-toggle="touchspin"]').each(function(t,e){var a=i.extend({},o,i(e).data());i(e).TouchSpin(a)})},t.prototype.initMaxlength=function(){var o={warningClass:"badge bg-success",limitReachedClass:"badge bg-danger",separator:" out of ",preText:"You typed ",postText:" chars available.",placement:"bottom"};i('[data-toggle="maxlength"]').each(function(t,e){var a=i.extend({},o,i(e).data());i(e).maxlength(a)})},t.prototype.init=function(){this.initSelect2(),this.initMask(),this.initDateRange(),this.initTimePicker(),this.initTouchspin(),this.initMaxlength()},i.AdvanceFormApp=new t,i.AdvanceFormApp.Constructor=t}(window.jQuery),function(c){"use strict";function t(){}t.prototype.send=function(t,e,a,o,n,i,r,s){var d={heading:t,text:e,position:a,loaderBg:o,icon:n,hideAfter:i=i||3e3,stack:r=r||1};d.showHideTransition=s||"fade",c.toast().reset("all"),c.toast(d)},c.NotificationApp=new t,c.NotificationApp.Constructor=t}(window.jQuery),function(a){"use strict";function t(){}t.prototype.initTooltipPlugin=function(){a.fn.tooltip&&a('[data-toggle="tooltip"]').tooltip()},t.prototype.initPopoverPlugin=function(){a.fn.popover&&a('[data-bs-toggle="popover"]').each(function(t,e){a(this).popover()})},t.prototype.initToastPlugin=function(){a.fn.toast&&a('[data-toggle="toast"]').toast()},t.prototype.initFormValidation=function(){a(".needs-validation").on("submit",function(t){return a(this).addClass("was-validated"),!1!==a(this)[0].checkValidity()||(t.preventDefault(),t.stopPropagation(),!1)})},t.prototype.initShowHidePassword=function(){a("[data-password]").on("click",function(){"false"==a(this).attr("data-password")?(a(this).siblings("input").attr("type","text"),a(this).attr("data-password","true"),a(this).addClass("show-password")):(a(this).siblings("input").attr("type","password"),a(this).attr("data-password","false"),a(this).removeClass("show-password"))})},t.prototype.initMultiDropdown=function(){a(".dropdown-menu a.dropdown-toggle").on("click",function(){return a(this).next().hasClass("show")||a(this).parents(".dropdown-menu").first().find(".show").removeClass("show"),a(this).next(".dropdown-menu").toggleClass("show"),!1})},t.prototype.initSyntaxHighlight=function(){a(document).ready(function(t){document.querySelectorAll("pre span.escape").forEach(function(t,e){for(var a=1/0,o=(t.classList.contains("escape"),t.innerText).replace(/^\n/,"").trimRight().split("\n"),n=0;n<o.length;n++)o[n].trim()&&(a=Math.min(o[n].search(/\S/),a));for(var i=[],n=0;n<o.length;n++)i.push(o[n].replace(new RegExp("^ {"+a+"}","g"),""));t.innerText=i.join("\n")}),document.querySelectorAll("pre span.escape").forEach(function(t){hljs.highlightBlock(t)})})},t.prototype.init=function(){this.initTooltipPlugin(),this.initPopoverPlugin(),this.initToastPlugin(),this.initFormValidation(),this.initShowHidePassword(),this.initMultiDropdown(),this.initSyntaxHighlight()},a.Components=new t,a.Components.Constructor=t}(window.jQuery),function(n){"use strict";function t(){this.$body=n("body"),this.$window=n(window)}t.prototype.activateDefaultSidebarTheme=function(){n.LayoutThemeApp.activateDefaultSidebarTheme()},t.prototype.activateLightSidebarTheme=function(){n.LayoutThemeApp.activateLightSidebarTheme()},t.prototype.activateDarkSidebarTheme=function(){n.LayoutThemeApp.activateDarkSidebarTheme()},t.prototype.activateCondensedSidebar=function(){n.LayoutThemeApp.activateCondensedSidebar()},t.prototype.deactivateCondensedSidebar=function(){n.LayoutThemeApp.deactivateCondensedSidebar()},t.prototype.activateScrollableSidebar=function(){n.LayoutThemeApp.activateScrollableSidebar()},t.prototype.deactivateScrollableSidebar=function(){n.LayoutThemeApp.deactivateScrollableSidebar()},t.prototype.activateBoxed=function(){n.LayoutThemeApp.activateBoxed()},t.prototype.activateFluid=function(){n.LayoutThemeApp.activateFluid()},t.prototype.activateDarkMode=function(){n.LayoutThemeApp.activateDarkMode()},t.prototype.deactivateDarkMode=function(){n.LayoutThemeApp.deactivateDarkMode()},t.prototype.clearSavedConfig=function(){n.LayoutThemeApp.clearSavedConfig()},t.prototype.getLayoutConfig=function(){return n.LayoutThemeApp.getConfig()},t.prototype.resetLayout=function(t){n.LayoutThemeApp.reset(t)},t.prototype.init=function(){n.LayoutThemeApp.init(),setTimeout(function(){document.body.classList.remove("loading"),n("[autofocus]").trigger("focus")},400),n.RightBar.init();var t=this.$body.data("layoutConfig");window.sessionStorage&&t&&t.hasOwnProperty("showRightSidebarOnStart")&&t.showRightSidebarOnStart&&(sessionStorage.getItem("_HYPER_VISITED_")||(n.RightBar.toggleRightSideBar(),sessionStorage.setItem("_HYPER_VISITED_",!0))),n.Portlet.init(),n.AdvanceFormApp.init(),n.Components.init(),n(window).on("load",function(){n("#status").fadeOut(),n("#preloader").delay(350).fadeOut("slow")});[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(t){return new bootstrap.Popover(t)}),[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(t){return new bootstrap.Tooltip(t,{trigger:"hover"})}),[].slice.call(document.querySelectorAll(".offcanvas")).map(function(t){return new bootstrap.Offcanvas(t)});var e=document.getElementById("toastPlacement");e&&document.getElementById("selectToastPlacement").addEventListener("change",function(){e.dataset.originalClass||(e.dataset.originalClass=e.className),e.className=e.dataset.originalClass+" "+this.value});[].slice.call(document.querySelectorAll(".toast")).map(function(t){return new bootstrap.Toast(t)});var o=document.getElementById("liveAlertPlaceholder"),a=document.getElementById("liveAlertBtn");a&&a.addEventListener("click",function(){var t,e,a;t="Nice, you triggered this alert message!",e="success",(a=document.createElement("div")).innerHTML='<div class="alert alert-'+e+' alert-dismissible" role="alert">'+t+'<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>',o.append(a)}),document.getElementById("app-style").href.includes("rtl.min.css")&&(document.getElementsByTagName("html")[0].dir="rtl")},n.App=new t,n.App.Constructor=t}(window.jQuery),function(){"use strict";window.jQuery.App.init()}();
//# sourceMappingURL=app.min.js.map
// Close only sidebar dropdowns when clicking outside the sidebar
// Close only sidebar collapses when clicking outside sidebar
document.addEventListener('click', function (e) {
  const sidebar = document.querySelector('.side-nav');
  const dropdowns = document.querySelectorAll('.side-nav .collapse.show');

  if (sidebar && !sidebar.contains(e.target)) {
    dropdowns.forEach(function (openMenu) {
      bootstrap.Collapse.getOrCreateInstance(openMenu, { toggle: false }).hide();
    });
  }
});
document.addEventListener("DOMContentLoaded", function () {
  const dropdown = document.querySelector(".nav-user");
  const menu = document.querySelector(".profile-dropdown");

  if (dropdown && menu) {
   
    // For click/touch (mobile)
    dropdown.addEventListener("click", (e) => {
      e.preventDefault();
      menu.classList.toggle("show");
    });

    // Close dropdown when clicking outside
    document.addEventListener("click", (e) => {
      if (!dropdown.contains(e.target)) {
        menu.classList.remove("show");
      }
    });
  }
});
document.addEventListener("DOMContentLoaded", function () {
  const calendarEl = document.getElementById("calendar");

  // âœ… Load events from localStorage or defaults
  let storedEvents = JSON.parse(localStorage.getItem("savedEvents")) || [
    { title: "Employee Health Screening", start: "2025-10-26", color: "#0dcaf0" },
    { title: "Client Advisory Board Meeting", start: "2025-10-28", color: "#b5179e" },
    { title: "Meeting with John Smith", start: "2025-11-05", color: "#e63946" },
    { title: "Company Anniversary Celebration", start: "2025-11-07", color: "#2a9d8f" },
    { title: "Leadership Summit", start: "2025-11-19", color: "#52b788" },
    { title: "Networking Mixer", start: "2025-11-27", color: "#d00000" },
    { title: "Job Training Fair", start: "2025-11-29", color: "#7209b7" },
    { title: "Sales Training Workshop", start: "2025-11-30", color: "#00b4d8" }
  ];

  // âœ… Initialize FullCalendar
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridMonth",
    height: "auto",
    headerToolbar: {
      left: "prev,next today",
      center: "title",
      right: "dayGridMonth,timeGridWeek,timeGridDay,listWeek"
    },
    events: storedEvents,

    eventClick: function (info) {
      const event = info.event;
      document.getElementById("eventDetailsTitle").textContent = event.title;
      document.getElementById("eventDetailsDate").textContent =
        event.start ? event.start.toLocaleString() : "N/A";
      document.getElementById("eventDetailsColor").style.backgroundColor =
        event.backgroundColor || "#0d6efd";

      document.getElementById("eventDetailsModal").dataset.eventId = event.id || event.startStr;

      const eventDetailsModal = new bootstrap.Modal(document.getElementById("eventDetailsModal"));
      eventDetailsModal.show();
    }
  });

  calendar.render();

  const addEventBtn = document.getElementById("addEventBtn");
  const eventModal = new bootstrap.Modal(document.getElementById("eventModal"));
  const eventForm = document.getElementById("eventForm");

  // âœ… Success modal
  const successModalHTML = `
    <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content border-0 shadow">
          <div class="modal-body text-center p-4">
            <i class="fa-solid fa-circle-check text-success fs-1 mb-3"></i>
            <h5 class="mb-2">Action completed successfully!</h5>
            <button type="button" class="btn btn-success btn-sm mt-2" data-bs-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>`;
  document.body.insertAdjacentHTML("beforeend", successModalHTML);
  const successModal = new bootstrap.Modal(document.getElementById("successModal"));

  // âœ… Delete confirmation modal
  const deleteConfirmHTML = `
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title">Confirm Delete</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body text-center">
            <p>Are you sure you want to delete this event?</p>
          </div>
          <div class="modal-footer justify-content-center">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>
    </div>`;
  document.body.insertAdjacentHTML("beforeend", deleteConfirmHTML);
  const deleteConfirmModal = new bootstrap.Modal(document.getElementById("deleteConfirmModal"));

  // âœ… Add Event Button
  addEventBtn.addEventListener("click", () => {
    eventForm.reset();
    eventModal.show();
  });

  // âœ… Add new event
  eventForm.addEventListener("submit", function (e) {
    e.preventDefault();

    const title = document.getElementById("eventTitle").value.trim();
    const startDate = document.getElementById("startDate").value;
    const color = document.getElementById("eventColor").value;

    if (!title || !startDate) {
      alert("Please fill in all required fields.");
      return;
    }

    const newEvent = { title, start: startDate, color };

    calendar.addEvent(newEvent);
    storedEvents.push(newEvent);
    localStorage.setItem("savedEvents", JSON.stringify(storedEvents));

    eventModal.hide();
    setTimeout(() => successModal.show(), 300);
  });

  // âœ… Edit button â€” open edit modal
  document.getElementById("editEventBtn").addEventListener("click", function () {
    const eventId = document.getElementById("eventDetailsModal").dataset.eventId;
    const event = calendar.getEvents().find(e => e.id === eventId || e.startStr === eventId);
    if (!event) return;

    document.getElementById("editTitle").value = event.title;
    document.getElementById("editDate").value = event.startStr;
    document.getElementById("editColor").value = event.backgroundColor;

    const editModal = new bootstrap.Modal(document.getElementById("editEventModal"));
    editModal.show();
  });

  // âœ… Save changes â€” update calendar & localStorage
  document.getElementById("saveEditBtn").addEventListener("click", function () {
    const eventId = document.getElementById("eventDetailsModal").dataset.eventId;
    const event = calendar.getEvents().find(e => e.id === eventId || e.startStr === eventId);
    if (!event) return;

    const newTitle = document.getElementById("editTitle").value.trim();
    const newDate = document.getElementById("editDate").value;
    const newColor = document.getElementById("editColor").value;

    event.setProp("title", newTitle);
    event.setStart(newDate);
    event.setProp("backgroundColor", newColor);

    storedEvents = calendar.getEvents().map(e => ({
      title: e.title,
      start: e.startStr,
      color: e.backgroundColor
    }));
    localStorage.setItem("savedEvents", JSON.stringify(storedEvents));

    bootstrap.Modal.getInstance(document.getElementById("editEventModal")).hide();
    bootstrap.Modal.getInstance(document.getElementById("eventDetailsModal")).hide();

    setTimeout(() => successModal.show(), 300);
  });

  // âœ… Delete event â€” show modal instead of alert
  let eventToDelete = null;

  document.getElementById("deleteEventBtn").addEventListener("click", function () {
    const eventId = document.getElementById("eventDetailsModal").dataset.eventId;
    eventToDelete = calendar.getEvents().find(e => e.id === eventId || e.startStr === eventId);
    if (eventToDelete) deleteConfirmModal.show();
  });

  document.getElementById("confirmDeleteBtn").addEventListener("click", function () {
    if (!eventToDelete) return;

    eventToDelete.remove();
    storedEvents = calendar.getEvents().map(e => ({
      title: e.title,
      start: e.startStr,
      color: e.backgroundColor
    }));
    localStorage.setItem("savedEvents", JSON.stringify(storedEvents));

    deleteConfirmModal.hide();
    bootstrap.Modal.getInstance(document.getElementById("eventDetailsModal")).hide();
    setTimeout(() => successModal.show(), 300);
  });
});
// ========================= CLIENT & CONTACT DASHBOARD LOGIC =========================
document.getElementById('card-total-clients').addEventListener('click', function () {
  const tabEl = document.getElementById('clients-tab');
  const bsTab = new bootstrap.Tab(tabEl);
  bsTab.show();
  setTimeout(() => {
    document.getElementById('clientsTableBody')
      .querySelector('tr')
      ?.scrollIntoView({ behavior: 'smooth' });
  }, 150);
});

document.getElementById('card-total-contacts').addEventListener('click', function () {
  const tabEl = document.getElementById('contacts-tab');
  const bsTab = new bootstrap.Tab(tabEl);
  bsTab.show();
});

document.addEventListener("DOMContentLoaded", () => {
  // ========================= ELEMENT REFERENCES =========================
  const exportBtn = document.getElementById("exportExcel");
  const clientsTableBody = document.getElementById("clientsTableBody");
  const saveClientBtn = document.getElementById("saveClient");
  const successModal = new bootstrap.Modal(document.getElementById("successModal"));
  const editModal = new bootstrap.Modal(document.getElementById("editClientModal"));
  const deleteModal = new bootstrap.Modal(document.getElementById("deleteConfirmModal"));
  const saveEditChangesBtn = document.getElementById("saveEditChanges");
  const confirmDeleteBtn = document.getElementById("confirmDelete");
  const totalClientsEl = document.querySelector("#card-total-clients .h4");
  const addClientModal = document.getElementById("addClientModal");
  const searchInput = document.getElementById("searchClient");

  let clients = JSON.parse(localStorage.getItem("clientsData")) || [];
  let editIndex = null;
  let deleteIndex = null;

  // ========================= UTILITY FUNCTIONS =========================
  function saveClients() {
    localStorage.setItem("clientsData", JSON.stringify(clients));
    if (totalClientsEl) totalClientsEl.textContent = clients.length;
  }

  // âœ… Render clients in table
  function renderClients() {
    clientsTableBody.innerHTML = "";
    clients.forEach((c, index) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${c.id}</td>
       <td>
  <a href="Client-View.php?id=${c.id}" 
     class="text-decoration-none text-primary fw-semibold">
     ${c.name}
  </a>
</td>
        <td>${c.primaryContact}</td>
        <td>${c.phone}</td>
        <td>${c.clientGroup}</td>
        <td>${c.labels || ""}</td>
        <td>${c.projects || ""}</td>
        <td>$${c.totalInvoiced || 0}</td>
        <td>$${c.paymentReceived || 0}</td>
        <td>$${c.due || 0}</td>
        <td>
          <button class="btn btn-sm btn-outline-primary me-1 editBtn">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button class="btn btn-sm btn-outline-danger deleteBtn">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      `;
      clientsTableBody.appendChild(row);

      // âœï¸ Edit button
      row.querySelector(".editBtn").addEventListener("click", () => {
        editIndex = index;
        document.getElementById("editClientName").value = c.name;
        document.getElementById("editPrimaryContact").value = c.primaryContact;
        document.getElementById("editPhone").value = c.phone;
        document.getElementById("editClientGroup").value = c.clientGroup;
        editModal.show();
      });

      // âŒ Delete button
      row.querySelector(".deleteBtn").addEventListener("click", () => {
        deleteIndex = index;
        deleteModal.show();
      });
    });
    saveClients();
  }

  // ========================= ADD CLIENT =========================
  // ðŸ§© Live input restriction for Add Client modal
// ========================= ADD CLIENT =========================
// ðŸ§© Live input restriction for Add Client modal
document.getElementById("clientName").addEventListener("input", function () {
  this.value = this.value.replace(/[^A-Za-z\s]/g, "");
});

document.getElementById("phone").addEventListener("input", function () {
  this.value = this.value.replace(/[^0-9\-]/g, "");
});

saveClientBtn.addEventListener("click", () => {
  const clientNameEl = document.getElementById("clientName");
  const primaryContactEl = document.getElementById("primaryContact");
  const phoneEl = document.getElementById("phone");

  const clientName = clientNameEl.value.trim();
  const primaryContact = primaryContactEl.value.trim();
  const phone = phoneEl.value.trim();

  // ðŸ§© Basic Validation
  let isValid = true;

  // Reset previous error styles
  [clientNameEl, primaryContactEl, phoneEl].forEach(el => {
    el.classList.remove("is-invalid");
  });

  if (clientName === "") {
    clientNameEl.classList.add("is-invalid");
    isValid = false;
  }

  if (primaryContact === "") {
    primaryContactEl.classList.add("is-invalid");
    isValid = false;
  }

  if (phone === "") {
    phoneEl.classList.add("is-invalid");
    isValid = false;
  }

  // ðŸ›‘ Stop if validation fails
  if (!isValid) return;

  // ðŸ§© No alerts needed since typing restriction is active
  const newClient = {
    id: clients.length + 1,
    name: clientName,
    primaryContact,
    phone,
    clientGroup: document.getElementById("clientGroup").value,
    labels: document.getElementById("labels").value,
    projects: document.getElementById("projects").value,
    totalInvoiced: document.getElementById("totalInvoiced").value,
    paymentReceived: document.getElementById("paymentReceived").value,
    due: document.getElementById("due").value
  };

  clients.push(newClient);
  renderClients();

  // Reset + close modal + show success popup
  document.getElementById("addClientForm").reset();
  bootstrap.Modal.getInstance(addClientModal)?.hide();

  document.querySelector("#successModal .modal-title").textContent = "Client Added Successfully!";
  document.getElementById("successMessage").textContent = "The client has been added successfully.";
  successModal.show();
});

// ðŸ§© Fix for blur after success popup closes
document.querySelector("#successModal").addEventListener("hidden.bs.modal", function () {
  // Remove leftover backdrop and restore normal view
  document.querySelectorAll(".modal-backdrop").forEach(el => el.remove());
  document.body.classList.remove("modal-open");
  document.body.style = "";
});

  // ========================= EDIT CLIENT =========================
  // ðŸ§© Real-time restriction for edit modal fields
document.getElementById("editClientName").addEventListener("input", function () {
  this.value = this.value.replace(/[^A-Za-z\s]/g, "");
});

document.getElementById("editPhone").addEventListener("input", function () {
  this.value = this.value.replace(/[^0-9\-]/g, "");
});

saveEditChangesBtn.addEventListener("click", () => {
  if (editIndex !== null) {
    const editedName = document.getElementById("editClientName").value.trim();
    const editedPhone = document.getElementById("editPhone").value.trim();

    // No alerts â€” just save whatâ€™s already valid
    clients[editIndex].name = editedName;
    clients[editIndex].primaryContact = document.getElementById("editPrimaryContact").value.trim();
    clients[editIndex].phone = editedPhone;
    clients[editIndex].clientGroup = document.getElementById("editClientGroup").value.trim();

    renderClients();
    editModal.hide();

    // âœ… Success popup message
    document.querySelector("#successModal .modal-title").textContent = "Client Updated Successfully!";
    const msg = document.getElementById("successMessage");
    if (msg) msg.textContent = "The client details were updated successfully.";
    successModal.show();
  }
});


  // ========================= DELETE CLIENT =========================
  confirmDeleteBtn.addEventListener("click", () => {
    if (deleteIndex !== null) {
      clients.splice(deleteIndex, 1);
      renderClients();
      deleteModal.hide();

      document.querySelector("#successModal .modal-title").textContent = "Client Deleted Successfully!";
document.getElementById("successMessage").textContent = "The client record was deleted.";
successModal.show();
    }
  });

  // ========================= SEARCH =========================
  if (searchInput) {
    searchInput.addEventListener("keyup", () => {
      const filter = searchInput.value.toLowerCase();
      document.querySelectorAll("#clientsTableBody tr").forEach(row => {
        row.style.display = row.textContent.toLowerCase().includes(filter) ? "" : "none";
      });
    });
  }

  // ========================= EXPORT TO EXCEL =========================
  if (exportBtn) {
    exportBtn.addEventListener("click", () => {
      const clients = JSON.parse(localStorage.getItem("clientsData")) || [];
      if (clients.length === 0) {
        alert("âš ï¸ No clients available to export!");
        return;
      }

      try {
        const worksheet = XLSX.utils.json_to_sheet(clients);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Clients");
        XLSX.writeFile(workbook, "Clients_List.xlsx");
      } catch (err) {
        console.error("âŒ Error exporting Excel:", err);
        alert("Something went wrong while exporting the file.");
      }
    });
  }

  // ========================= INITIALIZE =========================
  renderClients();
  saveClients();
});
/* ============================================================
   âœ… SIDEBAR AUTO-HIGHLIGHT (SAFE)
============================================================ */
document.addEventListener('DOMContentLoaded', () => {
  try {
    const pathname = location.pathname.toLowerCase();
    const search = location.search.toLowerCase();
    const ref = document.referrer.toLowerCase();
    const filename = pathname.split('/').pop();

    let clientsLink =
      document.getElementById('clientsNav') ||
      document.querySelector('a.side-nav-link[href*="clients"]');

    if (!clientsLink) {
      for (const a of document.querySelectorAll("a.side-nav-link")) {
        if (a.textContent.toLowerCase().includes("client")) {
          clientsLink = a;
          break;
        }
      }
    }

    if (!clientsLink) return;

    const shouldActivate =
      filename.includes("client") ||
      search.includes("id=") ||
      ref.includes("clients");

    if (shouldActivate) {
      clientsLink.classList.add("active", "text-white");
      const li = clientsLink.closest(".side-nav-item");
      if (li) li.classList.add("active");

      const collapseParent = clientsLink.closest(".collapse");
      if (collapseParent) {
        collapseParent.classList.add("show");
        const toggler = document.querySelector(
          `[data-bs-target="#${collapseParent.id}"], [href="#${collapseParent.id}"]`
        );
        if (toggler) toggler.setAttribute("aria-expanded", "true");
      }
    }
  } catch (e) {
    console.warn("Sidebar highlight error:", e);
  }
});

/* ============================================================
   âœ… UNIVERSAL CLIENT DATA LOADER (UNBREAKABLE)
============================================================ */
(() => {
  const params = new URLSearchParams(location.search);
  const clientId = parseInt(params.get("id")) || 1;

  /* âœ… SAFE DOM OPERATIONS */
  const safe = {
    text(id, value = "-") {
      const el = document.getElementById(id);
      if (el) el.textContent = value;
    },
    html(id, value = "") {
      const el = document.getElementById(id);
      if (el) el.innerHTML = value;
    },
    href(id, value = "#") {
      const el = document.getElementById(id);
      if (el) el.href = value;
    }
  };

  /* ============================================================
     âœ… FETCH CLIENT JSON (NO UI BREAK EVEN IF MISSING)
  ============================================================ */
  fetch("clientsdata.php")
    .then(res => {
      if (!res.ok) throw new Error("clientsdata.php missing");
      return res.json();
    })
    .then(data => {
      const client = data.find(c => c.id === clientId);
      if (!client) {
        console.warn("Client not found:", clientId);
        return;
      }

      /* âœ… BASIC INFO */
      safe.text("clientTitle", `${client.name} â€” Client Details`);
      safe.text("clientName", client.name);
      safe.text("clientTagline", client.tagline);
      safe.text("organization", client.organization);
      safe.text("organizationInfo", client.organization);
      safe.text(
        "clientMeta",
        `${client.type || ""} â€¢ ${client.industry || ""}`
      );
      safe.text("contactName", client.contactName);
      safe.text("phone", client.phone);
      safe.text("email", client.email);
      safe.text("address", client.address);
      safe.text("joinedDate", client.joinedDate);
      safe.text("clientStatus", client.status);
      safe.href("clientWebsite", client.website);

      /* âœ… PROJECTS & SUBSCRIPTIONS (TAB) */
      safe.text("projectSummary", (client.projects || 0) + " Projects");
      safe.text("subscriptionInfo", (client.subscriptions || 0) + " Subscriptions");

      /* ============================================================
         âœ… INVOICES
      ============================================================ */
      if (client.invoices) {
        const inv = client.invoices;

        safe.text("overdue", inv.overdue);
        safe.text("notPaid", inv.notPaid);
        safe.text("partiallyPaid", inv.partiallyPaid);
        safe.text("fullyPaid", inv.fullyPaid);
        safe.text("draft", inv.draft);
        safe.text("payments", inv.payments);
        safe.text("due", inv.due);
        safe.text("totalInvoiced", inv.totalInvoiced);
        safe.text("invoiceTotal", inv.totalInvoiced);

        /* âœ… Recent Invoice List */
        const ri = document.getElementById("recentInvoices");
        if (ri) {
          ri.innerHTML = "";
          if (inv.recent?.length) {
            inv.recent.slice(0, 5).forEach(x => {
              ri.innerHTML += `
              <li class="list-group-item d-flex justify-content-between">
                <div>
                  <div class="fw-semibold">#${x.number} â€¢ ${x.title}</div>
                  <div class="small text-muted">${x.date}</div>
                </div>
                <div class="text-end small">$${x.amount}</div>
              </li>`;
            });
          } else {
            ri.innerHTML = `<li class="list-group-item text-muted">No invoices yet.</li>`;
          }
        }
      }

      /* ============================================================
         âœ… TASKS
      ============================================================ */
      const taskList = document.getElementById("taskList");
      if (taskList) {
        taskList.innerHTML = "";
        if (client.tasks?.length) {
          client.tasks.forEach(t => {
            taskList.innerHTML += `
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">${t.title}</div>
                <div class="small text-muted">${t.dueDate || ""}</div>
              </div>
              <input type="checkbox" ${t.done ? "checked" : ""}>
            </li>`;
          });
        } else {
          taskList.innerHTML = `<li class="list-group-item text-muted">No tasks yet.</li>`;
        }
      }

      /* ============================================================
         âœ… TICKETS
      ============================================================ */
      const ticketArea = document.getElementById("ticketArea");
      if (ticketArea) {
        ticketArea.innerHTML = "";
        if (client.tickets?.length) {
          client.tickets.forEach(t => {
            ticketArea.innerHTML += `
            <div class="mb-2">
              <div class="fw-semibold">${t.title}</div>
              <div class="small text-muted">${t.status} â€¢ ${t.date}</div>
            </div>`;
          });
        } else {
          ticketArea.innerHTML = `<p class="text-muted mb-0">No tickets available.</p>`;
        }
      }

      /* ============================================================
         âœ… REMINDERS
      ============================================================ */
      const reminderList = document.getElementById("reminderList");
      if (reminderList) {
        reminderList.innerHTML = "";
        if (client.reminders?.length) {
          client.reminders.forEach(r => {
            reminderList.innerHTML += `
            <li class="list-group-item">
              <div class="fw-semibold">${r.title}</div>
              <div class="small text-muted">${r.date} ${r.time || ""}</div>
            </li>`;
          });
        } else {
          reminderList.innerHTML = `<li class="list-group-item text-muted">No reminders set.</li>`;
        }
      }

      /* ============================================================
         âœ… EVENTS CALENDAR (LOAD ONLY IF CALENDAR EXISTS)
      ============================================================ */
      if (document.getElementById("calendarBody")) {
        buildCalendar(client.events || []);
      }

    })
    .catch(err => {
      console.warn("âš  Client JSON could not be loaded:", err.message);
    });

  /* ============================================================
     âœ… SAFE CALENDAR ENGINE (Only runs if elements exist)
  ============================================================ */
  function buildCalendar(events = []) {
    const selectedDateLabel = document.getElementById("selectedDateLabel");
    const dayEventsList = document.getElementById("dayEventsList");
    const calendarWeekdays = document.getElementById("calendarWeekdays");
    const calendarBody = document.getElementById("calendarBody");
    const calendarMonthLabel = document.getElementById("calendarMonthLabel");

    if (!calendarBody || !calendarWeekdays) return;

    let calYear, calMonth;
    const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
    const eventsMap = {};

    events.forEach(ev => {
      if (!eventsMap[ev.date]) eventsMap[ev.date] = [];
      eventsMap[ev.date].push(ev);
    });

    function renderWeekdays() {
      calendarWeekdays.innerHTML = "";
      weekdays.forEach(w => {
        calendarWeekdays.innerHTML += `<th class="text-center">${w}</th>`;
      });
    }

    function renderCalendar() {
      const today = new Date();
      if (!calYear) { calYear = today.getFullYear(); calMonth = today.getMonth(); }

      const first = new Date(calYear, calMonth, 1);
      const last = new Date(calYear, calMonth + 1, 0);
      const start = first.getDay();
      const total = last.getDate();

      calendarMonthLabel.textContent = `${first.toLocaleString("default", { month: "long" })} ${calYear}`;
      calendarBody.innerHTML = "";

      let row = "<tr>";

      for (let i = 0; i < start; i++) row += "<td></td>";

      for (let day = 1; day <= total; day++) {
        const dateKey = `${calYear}-${String(calMonth + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
        const count = eventsMap[dateKey]?.length || 0;

        row += `
        <td class="align-top" style="cursor:pointer" onclick="selectCalDate('${dateKey}')">
          <div class="small text-muted mb-1">${day}</div>
          ${count ? `<span class="badge bg-primary" style="font-size:.6rem">${count}</span>` : ""}
        </td>`;

        if ((start + day) % 7 === 0) {
          row += "</tr>";
          calendarBody.innerHTML += row;
          row = "<tr>";
        }
      }

      row += "</tr>";
      calendarBody.innerHTML += row;
    }

    window.selectCalDate = function(dateKey) {
      if (!selectedDateLabel || !dayEventsList) return;

      selectedDateLabel.textContent = dateKey;
      dayEventsList.innerHTML = "";

      const evs = eventsMap[dateKey] || [];

      if (!evs.length) {
        dayEventsList.innerHTML = `<li class="list-group-item text-muted">No events.</li>`;
        return;
      }

      evs.forEach(ev => {
        dayEventsList.innerHTML += `
        <li class="list-group-item">
          <div class="fw-semibold">${ev.title}</div>
          <div class="small text-muted">${ev.time || ""} ${ev.location || ""}</div>
        </li>`;
      });
    };

    renderWeekdays();
    renderCalendar();
  }
})();
/* âœ… FIX: REMOVE BLUR / BACKDROP AFTER SUCCESS MODAL */
function resetBackdrop() {
  document.body.classList.remove("modal-open");

  document.querySelectorAll(".modal-backdrop").forEach(el => el.remove());
  document.querySelectorAll(".offcanvas-backdrop").forEach(el => el.remove());

  document.body.style.removeProperty("padding-right");
  document.body.style.overflow = "auto";
}
/* âœ… FIX: OK BUTTON SHOULD REMOVE BLUR */
document.addEventListener("DOMContentLoaded", () => {
  const okBtn = document.querySelector("#projectSuccessModal .btn-success");

  if (okBtn) {
    okBtn.addEventListener("click", () => {
      setTimeout(resetBackdrop, 250); // allow fade-out animation
    });
  }

  const sm = document.getElementById("projectSuccessModal");
  if (sm) {
    sm.addEventListener("hidden.bs.modal", () => {
      setTimeout(resetBackdrop, 250);
    });
  }
});
(() => {
  // ---------- CONFIG ----------
  const PAGE_SIZE = 10;

  // ---------- STATE ----------
  let projects = []; 
  let filtered = []; 
  let currentPage = 1;
  let currentFilter = "all";
  let currentSearch = "";
  let deleteCandidateId = null;

  const params = new URLSearchParams(location.search);
  const clientId = parseInt(params.get("id")) || 1;
  const storageKey = `projects_client_${clientId}`;

  // ---------- DOM SHORTCUTS ----------
  const $ = id => document.getElementById(id);
  const exists = id => !!$(id);

  // ---------- UTIL ----------
  function uid() {
    return Date.now().toString(36) + Math.random().toString(36).slice(2,8);
  }

  function showSuccess(msg) {
    const textEl = $("projectSuccessText");
    if (textEl) textEl.textContent = msg || "Success!";
    const modalEl = $("projectSuccessModal");
    if (modalEl) new bootstrap.Modal(modalEl).show();
  }

  function saveToLocal() {
    try {
      localStorage.setItem(storageKey, JSON.stringify(projects));
    } catch (e) {
      console.warn("Could not save to localStorage", e);
    }
  }

  // ---------- LOAD PROJECT DATA ----------
  async function loadProjectsData() {
    try {
      const saved = localStorage.getItem(storageKey);
      if (saved) {
        projects = JSON.parse(saved);
        return;
      }
    } catch {}

    try {
      if (window.clientProjects && Array.isArray(window.clientProjects)) {
        projects = window.clientProjects;
        saveToLocal();
        return;
      }
    } catch {}

    try {
      if (window.client && Array.isArray(window.client.projects)) {
        projects = window.client.projects;
        saveToLocal();
        return;
      }
    } catch {}

    try {
      const resp = await fetch("clientsdata.php");
      if (resp.ok) {
        const data = await resp.json();
        const c = data.find(x => Number(x.id) === Number(clientId));
        if (c && Array.isArray(c.projects)) {
          projects = c.projects;
          saveToLocal();
          return;
        }
      }
    } catch {}

    try {
      const resp = await fetch("clientsdata.php");
      if (resp.ok) {
        const arr = await resp.json();
        if (Array.isArray(arr)) {
          const hasClient = arr.some(x => x.clientId !== undefined);
          projects = hasClient ? arr.filter(x => Number(x.clientId) === Number(clientId)) : arr;
          saveToLocal();
          return;
        }
      }
    } catch {}

    projects = [];
  }

  // ---------- FILTER + SEARCH ----------
  function applyFiltersAndSearch() {
    filtered = projects.slice();

    if (currentFilter !== "all") {
      filtered = filtered.filter(p => (p.status || "").toLowerCase() === currentFilter.toLowerCase());
    }

    if (currentSearch.trim()) {
      const q = currentSearch.trim().toLowerCase();
      filtered = filtered.filter(p => 
        String(p.id).toLowerCase().includes(q) ||
        (p.title || "").toLowerCase().includes(q) ||
        String(p.price || "").toLowerCase().includes(q)
      );
    }
  }

  // ---------- RENDER PROJECT TABLE ----------
  function renderProjects() {
    if (!exists("projectsTableBody")) return;

    applyFiltersAndSearch();
    const tbody = $("projectsTableBody");
    tbody.innerHTML = "";

    const total = filtered.length;
    const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
    if (currentPage > totalPages) currentPage = totalPages;

    const start = (currentPage - 1) * PAGE_SIZE;
    const pageItems = filtered.slice(start, start + PAGE_SIZE);

    pageItems.forEach(p => {
      const tr = document.createElement("tr");

      const progressHtml = `
      <div class="progress" style="height:8px;">
        <div class="progress-bar" role="progressbar" style="width:${Number(p.progress || 0)}%"></div>
      </div>`;

      tr.innerHTML = `
        <td>${p.id}</td>
        <td>${escapeHtml(p.title)}</td>
        <td>$${p.price}</td>
        <td>${p.startDate}</td>
        <td>${p.deadline}</td>
        <td style="min-width:150px">${progressHtml}</td>
        <td>${renderStatusBadge(p.status)}</td>
        <td>
          <div class="btn-group">
            <button class="btn btn-sm btn-outline-secondary edit-project" data-id="${p.id}">Edit</button>
            <button class="btn btn-sm btn-outline-danger delete-project" data-id="${p.id}">Delete</button>
          </div>
        </td>
      `;
      tbody.appendChild(tr);
    });

    if (exists("paginationText")) {
      const low = total === 0 ? 0 : start + 1;
      const high = start + pageItems.length;
      $("paginationText").textContent = `${PAGE_SIZE} â€¢ ${low}-${high} / ${total}`;
    }
  }

  function renderStatusBadge(s) {
    const st = (s || "").toLowerCase();
    if (st === "completed") return `<span class="badge bg-success">Completed</span>`;
    if (st === "hold") return `<span class="badge bg-info">On Hold</span>`;
    if (st === "canceled") return `<span class="badge bg-danger">Canceled</span>`;
    return `<span class="badge bg-primary">Open</span>`;
  }

  function escapeHtml(s) {
    if (!s) return "";
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#39;");
  }

  // ---------- UI CONTROLS ----------
  function attachControls() {
    if (exists("searchProjects")) {
      $("searchProjects").addEventListener("input", e => {
        currentSearch = e.target.value;
        currentPage = 1;
        renderProjects();
      });
    }

    document.addEventListener("click", e => {
      if (e.target.classList.contains("filter-status")) {
        currentFilter = e.target.dataset.status;
        currentPage = 1;
        renderProjects();
      }
    });

    if (exists("exportProjectsExcel")) {
      $("exportProjectsExcel").addEventListener("click", exportExcel);
    }

    if (exists("printProjects")) {
      $("printProjects").addEventListener("click", printTable);
    }
  }

  // ---------- CRUD HANDLERS ----------
  function attachCrudHandlers() {

    // âœ… SAVE NEW PROJECT (FIX APPLIED)
    if (exists("saveProject")) {
      $("saveProject").addEventListener("click", () => {
        const idEl = $("projectId");
        const titleEl = $("projectTitle");
        if (!idEl || !titleEl) return;

        const newP = {
          id: idEl.value || uid(),
          title: titleEl.value,
          price: Number($("projectPrice").value),
          startDate: $("projectStartDate").value,
          deadline: $("projectDeadline").value,
          progress: 0,
          status: $("projectStatus").value,
          clientId
        };

        const idx = projects.findIndex(x => String(x.id) === String(newP.id));
        if (idx >= 0) projects[idx] = newP; 
        else projects.unshift(newP);

        saveToLocal();
        renderProjects();

        // âœ… FIXED
        const m = bootstrap.Modal.getOrCreateInstance($("addProjectModal"));
        m.hide();

        showSuccess("Project saved");
      });
    }

    // Edit / Delete Delegation
    document.addEventListener("click", e => {
      const t = e.target;

      if (t.classList.contains("edit-project")) {
        openEditModal(t.dataset.id);
      }

      if (t.classList.contains("delete-project")) {
        deleteCandidateId = t.dataset.id;
        new bootstrap.Modal($("deleteProjectModal")).show();
      }
    });

    // âœ… DELETE CONFIRM (FIX APPLIED)
    if (exists("confirmDeleteProject")) {
      $("confirmDeleteProject").addEventListener("click", () => {
        projects = projects.filter(p => p.id != deleteCandidateId);
        saveToLocal();
        renderProjects();

        const m = bootstrap.Modal.getOrCreateInstance($("deleteProjectModal"));
        m.hide();

        showSuccess("Project deleted");
      });
    }

    // âœ… EDIT SAVE (FIX APPLIED)
    if (exists("saveProjectEdit")) {
      $("saveProjectEdit").addEventListener("click", () => {
        const id = $("editProjectId").value;
        const idx = projects.findIndex(p => String(p.id) === String(id));
        if (idx === -1) return;

        projects[idx].title = $("editProjectTitle").value;
        projects[idx].price = Number($("editProjectPrice").value);
        projects[idx].startDate = $("editProjectStartDate").value;
        projects[idx].deadline = $("editProjectDeadline").value;
        projects[idx].status = $("editProjectStatus").value;

        saveToLocal();
        renderProjects();

        const m = bootstrap.Modal.getOrCreateInstance($("editProjectModal"));
        m.hide();

        showSuccess("Project updated");
      });
    }

    if (exists("addProjectModal")) {
      $("addProjectModal").addEventListener("show.bs.modal", () => {
        $("projectId").value = uid();
        $("projectTitle").value = "";
        $("projectPrice").value = 0;
        $("projectStartDate").value = "";
        $("projectDeadline").value = "";
        $("projectStatus").value = "open";
      });
    }
  }

  function openEditModal(id) {
    const p = projects.find(x => String(x.id) === String(id));
    if (!p) return;

    $("editProjectId").value = p.id;
    $("editProjectTitle").value = p.title;
    $("editProjectPrice").value = p.price;
    $("editProjectStartDate").value = p.startDate;
    $("editProjectDeadline").value = p.deadline;
    $("editProjectStatus").value = p.status;

    new bootstrap.Modal($("editProjectModal")).show();
  }

  // ---------- EXPORT ----------
  function exportExcel() {
    const rows = [
      ["ID", "Title", "Price", "Start", "Deadline", "Progress", "Status"],
      ...projects.map(p => [p.id, p.title, p.price, p.startDate, p.deadline, p.progress, p.status])
    ];

    const csv = rows.map(r => r.join(",")).join("\n");
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "projects.csv";
    a.click();

    URL.revokeObjectURL(url);
  }

  function printTable() {
    window.print();
  }

  // ---------- INIT ----------
  async function init() {
    attachControls();
    attachCrudHandlers();
    await loadProjectsData();
    renderProjects();
  }

  document.addEventListener("DOMContentLoaded", init);
})();
